<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta http-equiv="last-modified" content="2018-03-27 00:12:32 -0500">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- meta "search-domain" used for google site search function google_search() -->
    <meta name="search-domain" value="">
    <link rel="stylesheet" type="text/css" href="../assets/css/bootstrap.css" />
    <link rel="stylesheet" type="text/css" href="../assets/css/bootstrap-theme.css" />
    <link rel="stylesheet" type="text/css" href="../assets/css/lesson.css" />
    <link rel="stylesheet" type="text/css" href="../assets/css/syntax.css" />
    
    <link rel="shortcut icon" type="image/x-icon" href="/favicon-swc.ico" />
    
    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
	<script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
	<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
	<![endif]-->
    <title>Python for Business: Intro to Pandas</title>
  </head>
  <body>
    <div class="container">
      
<nav class="navbar navbar-default">
  <div class="container-fluid">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>

      
      

      
      <a class="navbar-brand" href="../">Home</a>

    </div>
    <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
      <ul class="nav navbar-nav">

	
        <li><a href="../conduct/">Code of Conduct</a></li>

        
	
        <li><a href="../setup/">Setup</a></li>

        
        <li class="dropdown">
          <a href="../" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">Episodes <span class="caret"></span></a>
          <ul class="dropdown-menu">
            
            <li><a href="../00-intro/">Python basics 1 - Intro to Python</a></li>
            
            <li><a href="../01-conditional_loop/">Python basics 2 - Conditional statements and Loops</a></li>
            
            <li><a href="../02-func/">Python basics 3 - Functions and Modules</a></li>
            
            <li><a href="../03-pandas/">Intro to Pandas</a></li>
            
            <li><a href="../04-stat_vis/">Statistical Analysis and Visualization</a></li>
            
            <li><a href="../05-errors/">Errors and Exceptions</a></li>
            
            <li><a href="../06-debugging/">Debugging</a></li>
            
	    <li role="separator" class="divider"></li>
            <li><a href="../aio/">All in one page (Beta)</a></li>
          </ul>
        </li>
	

	
	
        <li class="dropdown">
          <a href="../" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">Extras <span class="caret"></span></a>
          <ul class="dropdown-menu">
            <li><a href="../reference/">Reference</a></li>
            
            <li><a href="../about/">About</a></li>
            
            <li><a href="../discuss/">Discussion</a></li>
            
            <li><a href="../extras/figures.html">Figures</a></li>
            
            <li><a href="../guide/">Instructor Notes</a></li>
            
          </ul>
        </li>
	

	
        <li><a href="../LICENSE.html">License</a></li>
	
	<li><a href="/edit/gh-pages/_episodes/03-pandas.md">Improve this page <span class="glyphicon glyphicon-pencil" aria-hidden="true"></span></a></li>
	
      </ul>
      <form class="navbar-form navbar-right" role="search" id="search" onsubmit="google_search(); return false;">
        <div class="form-group">
          <input type="text" id="google-search" placeholder="Search..." aria-label="Google site search">
        </div>
      </form>
    </div>
  </div>
</nav>


<div class="row">
  <div class="col-xs-1">
    <h3 class="text-left">
      
      <a href="../02-func/"><span class="glyphicon glyphicon-menu-left" aria-hidden="true"></span><span class="sr-only">previous episode</span></a>
      
    </h3>
  </div>
  <div class="col-xs-10">
    
    <h3 class="maintitle"><a href="../">Python for Business</a></h3>
    
  </div>
  <div class="col-xs-1">
    <h3 class="text-right">
      
      <a href="../04-stat_vis/"><span class="glyphicon glyphicon-menu-right" aria-hidden="true"></span><span class="sr-only">next episode</span></a>
      
    </h3>
  </div>
</div>

<article>
<div class="row">
  <div class="col-md-1">
  </div>
  <div class="col-md-10">
    <h1 class="maintitle">Intro to Pandas</h1>
  </div>
  <div class="col-md-1">
  </div>
</div>


<blockquote class="objectives">
  <h2>Overview</h2>

  <div class="row">
    <div class="col-md-3">
      <strong>Teaching:</strong> 60 min
      <br/>
      <strong>Exercises:</strong> 0 min
    </div>
    <div class="col-md-9">
      <strong>Questions</strong>
      <ul>
	
	<li><p>How do I read a file</p>
</li>
	
	<li><p>What is pandas</p>
</li>
	
	<li><p>How to work with table-like data in Python like Excel</p>
</li>
	
      </ul>
    </div>
  </div>

  <div class="row">
    <div class="col-md-3">
    </div>
    <div class="col-md-9">
      <strong>Objectives</strong>
      <ul>
	
	<li><p>Describe what the Python Data Analysis Library (Pandas) is.</p>
</li>
	
	<li><p>Load the Python Data Analysis Library (Pandas).</p>
</li>
	
	<li><p>What’s in our data?</p>
</li>
	
	<li><p>Describe what a DataFrame is in Python.</p>
</li>
	
	<li><p>Access and summarize data stored in a DataFrame.</p>
</li>
	
	<li><p>Merge two dataframes, understand different types of join</p>
</li>
	
	<li><p>Perform basic mathematical operations and summary statistics on data in a Pandas DataFrame.</p>
</li>
	
	<li><p>Create pivot table</p>
</li>
	
      </ul>
    </div>
  </div>

</blockquote>

<h1 id="working-with-pandas-dataframes-in-python">Working With Pandas DataFrames in Python</h1>

<p>We can automate the process of performing data manipulations in Python. It’s efficient to spend time
building the code to perform these tasks because once it’s built, we can use it
over and over on different datasets that use a similar format. This makes our
methods easily reproducible. We can also easily share our code with colleagues
and they can replicate the same analysis.</p>

<h2 id="our-data">Our Data</h2>

<p>Please download the data for this workshop <a href="https://github.com/data-lessons/python-business/tree/gh-pages/data">tbd</a>. It is in zip format, please unzip it, and you will see an .csv file. There are two .csv files, <code class="highlighter-rouge">soda.csv</code> and <code class="highlighter-rouge">invoice.csv</code>.</p>

<p>Our database is about soda sales from the vendors to stores. Here is all types of data in the database:</p>

<table>
  <thead>
    <tr>
      <th>Columns</th>
      <th style="text-align: left">Data Type</th>
      <th>Description</th>
      <th>File</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>County_id</td>
      <td style="text-align: left">INTEGER</td>
      <td>Unique id for each county</td>
      <td>invoice.csv</td>
    </tr>
    <tr>
      <td>County_Name</td>
      <td style="text-align: left">String</td>
      <td>Name of county</td>
      <td>invoice.csv</td>
    </tr>
    <tr>
      <td>City_Name</td>
      <td style="text-align: left">String</td>
      <td>Name of the city that the county is in</td>
      <td>invoice.csv</td>
    </tr>
    <tr>
      <td>Vendor_id</td>
      <td style="text-align: left">INTEGER</td>
      <td>Unique id for each vendor</td>
      <td>invoice.csv</td>
    </tr>
    <tr>
      <td>Vendor_Name</td>
      <td style="text-align: left">String</td>
      <td>Name of the vendor</td>
      <td>invoice.csv</td>
    </tr>
    <tr>
      <td>Store_id</td>
      <td style="text-align: left">INTEGER</td>
      <td>Unique id for each store</td>
      <td>invoice.csv</td>
    </tr>
    <tr>
      <td>Store_Name</td>
      <td style="text-align: left">String</td>
      <td>Name of the store</td>
      <td>invoice.csv</td>
    </tr>
    <tr>
      <td>Address</td>
      <td style="text-align: left">String</td>
      <td>Address of the store</td>
      <td>invoice.csv</td>
    </tr>
    <tr>
      <td>Zip_Code</td>
      <td style="text-align: left">INTEGER</td>
      <td>Zip code of the store</td>
      <td>invoice.csv</td>
    </tr>
    <tr>
      <td>Invoice_id</td>
      <td style="text-align: left">String</td>
      <td>Unique id for each invoice</td>
      <td>invoice.csv</td>
    </tr>
    <tr>
      <td>Date</td>
      <td style="text-align: left">String</td>
      <td>Date of the invoice</td>
      <td>invoice.csv</td>
    </tr>
    <tr>
      <td>Bottle_Sold</td>
      <td style="text-align: left">INTEGER</td>
      <td>Number of bottle sold in the invoice</td>
      <td>invoice.csv</td>
    </tr>
    <tr>
      <td>Item_id</td>
      <td style="text-align: left">INTEGER</td>
      <td>Unique id for each item (soda)</td>
      <td>both</td>
    </tr>
    <tr>
      <td>Category</td>
      <td style="text-align: left">String</td>
      <td>Category of soda</td>
      <td>item.csv</td>
    </tr>
    <tr>
      <td>Item_Description</td>
      <td style="text-align: left">String</td>
      <td>Name of the item (soda)</td>
      <td>item.csv</td>
    </tr>
    <tr>
      <td>Pack</td>
      <td style="text-align: left">INTEGER</td>
      <td>Number of bottles that the soda usually sells for</td>
      <td>item.csv</td>
    </tr>
    <tr>
      <td>Bottle_Volume_ml</td>
      <td style="text-align: left">Float</td>
      <td>Volumn of the soda in ml</td>
      <td>item.csv</td>
    </tr>
    <tr>
      <td>Bottle_Cost</td>
      <td style="text-align: left">Float</td>
      <td>Cost of one bottle</td>
      <td>item.csv</td>
    </tr>
    <tr>
      <td>Bottle_Retail_Price</td>
      <td style="text-align: left">Float</td>
      <td>Retile price for one bottle</td>
      <td>item.csv</td>
    </tr>
  </tbody>
</table>

<p><code class="highlighter-rouge">csv</code> can be opened with Excel. However, Excel has a limit of 1,048,576 rows by 16,384 columns. Our <code class="highlighter-rouge">invoice.csv</code> data contains about 9 million rows of data, almost hitted the Excel limit. (Try to open it with Excel, how long it take to load it?)<br />
It took me more than a half minute to just open the file (with a 5th gen i5 processor computer). It would be slow and difficult to do further analytics. 
Excel is not very good when dealing with scalable data. Moreover, Excel is not very good at tracing modification records. On the other hand, a huge advantage of using python is that, without graphic interface, the processing of data will be much faster. Since you do your analytics with code, you can easily keep a record of what you have done. To deal with table-like data, we usually use a module called Pandas. In this section, you will learn the basics of Pandas. Since most of you are business students, I will also show you how to perform some frequent used Excel functionalities with Pandas.</p>

<h2 id="black-x6-phantom-white-x6-panda">black x6 phantom, white x6 panda</h2>
<p><img src="../pic/panda.png" alt="pandas" height="200px" /></p>

<h2 id="pandas-in-python">Pandas in Python</h2>
<p>One of the best options for working with tabular data in Python is to use the
<a href="http://pandas.pydata.org/">Python Data Analysis Library</a> (a.k.a. Pandas). The
Pandas library provides data structures, produces high quality plots with
<a href="http://matplotlib.org/">matplotlib</a> and integrates nicely with other libraries
that use <a href="http://www.numpy.org/">NumPy</a> (which is another Python library) arrays.</p>

<p>Python doesn’t load all of the libraries available to it by default. We have to
add an <code class="highlighter-rouge">import</code> statement to our code in order to use library functions.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="n">pd</span>
</code></pre></div></div>

<p>Each time we call a function that’s in a library, we use the syntax
<code class="highlighter-rouge">LibraryName.FunctionName</code>. Adding the library name with a <code class="highlighter-rouge">.</code> before the
function name tells Python where to find the function. In the example above, we
have imported Pandas as <code class="highlighter-rouge">pd</code>. This means we don’t have to type out <code class="highlighter-rouge">pandas</code> each
time we call a Pandas function.</p>

<h2 id="reading-csv-data-using-pandas">Reading CSV Data Using Pandas</h2>

<p>We will begin by locating and reading our survey data which are in CSV format. CSV stands for Comma-Separated Values and is a common way store formatted data. Other symbols my also be used, so you might see tab-separated, colon-separated or space separated files. It is quite easy to replace one separator with another, to match your application. The first line in the file often has headers to explain what is in each column. CSV (and other separators) make it easy to share data, and can be imported and exported from many applications, including Microsoft Excel. 
We can use Pandas’ <code class="highlighter-rouge">read_csv</code> function to pull the file directly into a <a href="http://pandas.pydata.org/pandas-docs/stable/dsintro.html#dataframe">DataFrame</a>.</p>

<h2 id="so-whats-a-dataframe">So What’s a DataFrame?</h2>

<p>A DataFrame is a 2-dimensional data structure that can store data of different
types (including characters, integers, floating point values, factors and more)
in columns. It is similar to a spreadsheet or an SQL table or the <code class="highlighter-rouge">data.frame</code> in
R. A DataFrame always has an index (0-based). An index refers to the position of
an element in the data structure.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># Note that pd.read_csv is used because we imported pandas as pd</span>
<span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s">"soda.csv"</span><span class="p">)</span>
</code></pre></div></div>

<p>The above command yields 930508 rows × 19 columns. The first column is the index of the DataFrame (which is not included in the 19 columns). The index is used to identify the position of the data, but it is not an actual column of the DataFrame.
It looks like  the <code class="highlighter-rouge">read_csv</code> function in Pandas  read our file properly. However,
we haven’t saved any data to memory so we can work with it.We need to assign the
DataFrame to a variable. Remember that a variable is a name for a value, such as <code class="highlighter-rouge">x</code>,
or  <code class="highlighter-rouge">data</code>. We can create a new  object with a variable name by assigning a value to it using <code class="highlighter-rouge">=</code>.</p>

<p>Let’s call the imported data into two DataFrames <code class="highlighter-rouge">soda</code> and <code class="highlighter-rouge">inv</code>:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">soda</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s">"soda.csv"</span><span class="p">)</span>
<span class="n">inv</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s">"invoice.csv"</span><span class="p">)</span>
</code></pre></div></div>

<p>Notice when you assign the imported DataFrame to a variable, Python does not
produce any output on the screen. We can view the value of the <code class="highlighter-rouge">soda</code>
object by typing its name into the Python command prompt.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">soda</span>
</code></pre></div></div>

<p>And you will see the dataframe.</p>

<p>Note: if the output is too wide to print on your narrow terminal window, you may see something 
slightly different as the large set of data scrolls past. 
Never fear, all the data is there, if you scroll up. Selecting just a few rows, so it is
easier to fit on one window, you can see that pandas has neatly formatted the data to fit
our screen/ 
You can also use the <code class="highlighter-rouge">head(n)</code> function displays the first n lines of a file. It will defaultly show the first 5 rows of the dataframe if you don’t fill in any numbers:</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">soda</span><span class="o">.</span><span class="n">head</span><span class="p">()</span> 
</code></pre></div></div>

<h2 id="exploring-our-data">Exploring Our Data</h2>

<p>Again, we can use the <code class="highlighter-rouge">type</code> function to see what kind of thing <code class="highlighter-rouge">soda</code> is:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">&gt;&gt;&gt;</span> <span class="nb">type</span><span class="p">(</span><span class="n">soda</span><span class="p">)</span>
<span class="o">&lt;</span><span class="k">class</span> <span class="err">'</span><span class="nc">pandas</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">frame</span><span class="o">.</span><span class="n">DataFrame</span><span class="s">'&gt;</span><span class="err">
</span></code></pre></div></div>

<p>As expected, it’s a DataFrame (or, to use the full name that Python uses to refer
to it internally, a <code class="highlighter-rouge">pandas.core.frame.DataFrame</code>).</p>

<p>What kind of things does <code class="highlighter-rouge">soda</code> and <code class="highlighter-rouge">inv</code> contain? DataFrames have an attribute
called <code class="highlighter-rouge">dtypes</code> that answers this:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">&gt;&gt;&gt;</span> <span class="n">soda</span><span class="o">.</span><span class="n">dtypes</span>
<span class="n">Item_id</span>                  <span class="n">int64</span>
<span class="n">Item_Description</span>        <span class="nb">object</span>
<span class="n">Category</span>                <span class="nb">object</span>
<span class="n">Pack</span>                     <span class="n">int64</span>
<span class="n">Bottle_Volume_ml</span>       <span class="n">float64</span>
<span class="n">Bottle_Cost</span>            <span class="n">float64</span>
<span class="n">Bottle_Retail_Price</span>    <span class="n">float64</span>
<span class="n">dtype</span><span class="p">:</span> <span class="nb">object</span>

<span class="o">&gt;&gt;&gt;</span> <span class="n">inv</span><span class="o">.</span><span class="n">dtypes</span>
<span class="n">Invoice_id</span>      <span class="nb">object</span>
<span class="n">Date</span>            <span class="nb">object</span>
<span class="n">Item_id</span>          <span class="n">int64</span>
<span class="n">Vendor_id</span>        <span class="n">int64</span>
<span class="n">Vendor_Name</span>     <span class="nb">object</span>
<span class="n">Store_id</span>         <span class="n">int64</span>
<span class="n">Store_Name</span>      <span class="nb">object</span>
<span class="n">Address</span>         <span class="nb">object</span>
<span class="n">City_Name</span>       <span class="nb">object</span>
<span class="n">Zip_Code</span>         <span class="n">int64</span>
<span class="n">County_id</span>        <span class="n">int64</span>
<span class="n">County_Name</span>     <span class="nb">object</span>
<span class="n">Bottles_Sold</span>     <span class="n">int64</span>
<span class="n">dtype</span><span class="p">:</span> <span class="nb">object</span>

</code></pre></div></div>

<p>All the values in a column have the same type. For example, Bottles_Sold have type
<code class="highlighter-rouge">int64</code>, which is a kind of integer.  Bottle_Cost has decimals and it have type <code class="highlighter-rouge">float64</code>. 
The <code class="highlighter-rouge">object</code> type doesn’t have a very helpful name, but in
this case it represents strings.</p>

<h3 id="useful-ways-to-view-dataframe-objects-in-python">Useful Ways to View DataFrame objects in Python</h3>

<p>There are many ways to summarize and access the data stored in DataFrames,
using attributes and methods provided by the DataFrame object.</p>

<p>To access an attribute, use the DataFrame object name followed by the attribute
name <code class="highlighter-rouge">df_object.attribute</code>. Using the DataFrame <code class="highlighter-rouge">soda</code> and attribute
<code class="highlighter-rouge">columns</code>, an index of all the column names in the DataFrame can be accessed
with <code class="highlighter-rouge">soda.columns</code>.</p>

<p>Methods are called in a similar fashion using the syntax <code class="highlighter-rouge">df_object.method()</code>.
As an example, <code class="highlighter-rouge">soda.head()</code> gets the first few rows in the DataFrame
<code class="highlighter-rouge">soda</code> using <strong>the <code class="highlighter-rouge">head()</code> method</strong>. With a method, we can supply extra
information in the parens to control behaviour.</p>

<p>Let’s look at the data using these.</p>

<blockquote class="challenge">
  <h2 id="try-the-following-methods-yourself">Try the following methods yourself:</h2>

  <p>Using our DataFrame <code class="highlighter-rouge">soda</code>, try out the attributes &amp; methods below to see
what they return.</p>

  <ol>
    <li><code class="highlighter-rouge">soda.columns</code></li>
    <li>
      <p><code class="highlighter-rouge">soda.shape</code> Take note of the output of <code class="highlighter-rouge">shape</code> - what format does it
return the shape of the DataFrame in?</p>

      <p>HINT: <a href="https://docs.python.org/3/tutorial/datastructures.html#tuples-and-sequences">More on tuples, here</a>.</p>
    </li>
    <li><code class="highlighter-rouge">soda.tail()</code></li>
  </ol>
</blockquote>

<h2 id="selecting-data">Selecting Data</h2>

<p>To get one column, you can do <code class="highlighter-rouge">df_object.column_name</code> or <code class="highlighter-rouge">df_object[column_name]</code>. It will return a <code class="highlighter-rouge">Series</code> object.
To get multiple columns, you can do <code class="highlighter-rouge">df_object[list_of_column_names]</code>. And it will return a <code class="highlighter-rouge">DataFrame</code> object. 
For example, you can get <code class="highlighter-rouge">Store_id</code> and <code class="highlighter-rouge">Store_Name</code> by:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>inv[["Store_id", "Store_Name"]]
</code></pre></div></div>
<p>Although you can select one column of the DataFrame with both of the following lines, they does not give you the same data type. You can check the datatype with <code class="highlighter-rouge">type()</code>.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>inv[["Store_id"]]
inv["Store_id"]  
</code></pre></div></div>

<p>Let’s get a list of all the categories. The <code class="highlighter-rouge">pd.unique</code> function tells us all of
the unique values in the <code class="highlighter-rouge">Category</code> column.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">pd</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">soda</span><span class="p">[</span><span class="s">'Category'</span><span class="p">])</span>
</code></pre></div></div>
<p>To see how many unique categories are there, we can do:</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>len(pd.unique(soda['Category']))
</code></pre></div></div>
<p>The above code returns an array of the unique <code class="highlighter-rouge">Item_Description</code>. <br />
You can also:</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>soda.drop_duplicates("Category")
</code></pre></div></div>
<p>This will return a DataFrame of unique values, and it will return you all the other columns besides <code class="highlighter-rouge">Category</code>.</p>

<h2 id="sorting-and-filtering-values-in-dataframe">Sorting and Filtering values in DataFrame</h2>
<p>Now you have a glance of how Pandas works. For us business students, we probablly interested in how to perform Excel tasks with python, so that we can deal with more scalable data. <br />
Firstly, sorting is very frequently used in Excel. Pandas has the same functionality:</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># sort by one column: </span>
<span class="n">df_object</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="s">"column_name"</span><span class="p">)</span>
<span class="c"># sort by multiple columns:  </span>
<span class="n">df_object</span><span class="o">.</span><span class="n">sort_values</span><span class="p">([</span><span class="n">list_of_column_name</span><span class="p">])</span>
</code></pre></div></div>
<p>For example, if you want to sort the <code class="highlighter-rouge">soda</code> DataFrame firstly by Bottle_Cost in ascending order and then by Item_Description in descending order, you can:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>soda.sort_values(["Bottle_Cost","Item_Description"], ascending=[True,False])
</code></pre></div></div>

<p>Filtering functionality in Excel is also very useful. It can select rows based on the value of another column. Pandas can do similar things.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">df_object</span><span class="p">[</span><span class="n">df_object</span><span class="p">[</span><span class="s">"column_name"</span><span class="p">]</span> <span class="o">==</span> <span class="n">value</span><span class="p">]</span> 
</code></pre></div></div>
<p>Let’s try to select all soda that has <code class="highlighter-rouge">Bottle_Cost</code> less than $3.</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>soda[soda["Bottle_Cost"]&lt;= 3]["Item_Description"]
# unique soda names  
</code></pre></div></div>
<blockquote class="challenge">
  <h2 id="challenge---summary-data">Challenge - Summary Data</h2>

  <p>If we need multiple criterias, we can put parentheses over each criterias and use <code class="highlighter-rouge">&amp;</code> (and) or <code class="highlighter-rouge">|</code> (or) to combine the criterias. For example, let’s select sodas that are at least 500ml and cheaper than $3.</p>

  <blockquote class="solution">
    <h2 id="solution">Solution</h2>
    <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>soda[(soda["Bottle_Volume_ml"] &gt;= 500) &amp; (soda["Bottle_Cost"]&lt;= 3)]["Item_Description"]
</code></pre></div>    </div>
  </blockquote>
</blockquote>

<h1 id="basic-arithmetics-with-pandas">Basic Arithmetics with Pandas</h1>
<p>Similar as Excel, Pandas allows you to do basic arithmetics with the numbers in the DataFrame.<br />
For example, if you want to calculate the pack price of each soda (Pack * Bottle_Retail_Price):</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>soda['Pack'] * soda['Bottle_Retail_Price']  
</code></pre></div></div>
<p>To assign a new column in <code class="highlighter-rouge">soda</code> DataFrame to store this result, we can:</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>soda['Pack_Price'] = soda['Pack'] * soda['Bottle_Retail_Price']  
</code></pre></div></div>
<p>If you don’t want this column, you can delete it by:</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>soda = soda.drop(['Pack_Price'], axis = 1)
</code></pre></div></div>
<p>Very important, the <code class="highlighter-rouge">.drop()</code> will not change anything in the original DataFrame. Instead, it will return a new dataframe with the “Pack_Price” column removed. You have to assign the new DataFrame to the variable <code class="highlighter-rouge">soda</code> with <code class="highlighter-rouge">soda =</code>.</p>

<blockquote class="challenge">
  <h2 id="challenge">Challenge</h2>

  <p>Create an column in the <code class="highlighter-rouge">soda</code> dataframe that shows the profit margin ((price-cost)/cost) of each soda.</p>

  <blockquote class="solution">
    <h2 id="solution-1">Solution</h2>
    <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>soda['Profit_Margin'] = (soda['Bottle_Retail_Price'] - soda['Bottle_Cost']) / soda['Bottle_Cost']
</code></pre></div>    </div>
  </blockquote>
</blockquote>

<h1 id="basic-statistics-with-pandas">Basic Statistics with Pandas</h1>

<p>Excel has “descriptive statistics” function in the built in data analytics tools. We can do similar things with Pandas. 
Let’s perform some quick summary statistics to learn more about the data that we’re working with. We can perform summary stats quickly using groups. But first we need to figure out what we want to group by.</p>

<p>We often want to calculate summary statistics grouped by subsets or attributes
within fields of our data. For example, we might want to calculate the average
cost of each soda.</p>

<p>We can calculate basic statistics for all records in a single column using the
syntax below:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">soda</span><span class="p">[</span><span class="s">'Bottle_Cost'</span><span class="p">]</span><span class="o">.</span><span class="n">describe</span><span class="p">()</span>
</code></pre></div></div>
<p>gives <strong>output</strong></p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">count</span>    <span class="mf">4166.000000</span>
<span class="n">mean</span>        <span class="mf">3.648721</span>
<span class="n">std</span>         <span class="mf">9.348512</span>
<span class="nb">min</span>         <span class="mf">1.500000</span>
<span class="mi">25</span><span class="o">%</span>         <span class="mf">2.360000</span>
<span class="mi">50</span><span class="o">%</span>         <span class="mf">2.860000</span>
<span class="mi">75</span><span class="o">%</span>         <span class="mf">3.610000</span>
<span class="nb">max</span>       <span class="mf">500.000000</span>
<span class="n">Name</span><span class="p">:</span> <span class="n">Bottle_Cost</span><span class="p">,</span> <span class="n">dtype</span><span class="p">:</span> <span class="n">float64</span>
</code></pre></div></div>

<p>We can also extract one specific metric if we wish:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">soda</span><span class="p">[</span><span class="s">'Bottle_Cost'</span><span class="p">]</span><span class="o">.</span><span class="nb">min</span><span class="p">()</span>
<span class="n">soda</span><span class="p">[</span><span class="s">'Bottle_Cost'</span><span class="p">]</span><span class="o">.</span><span class="nb">max</span><span class="p">()</span>
<span class="c"># We can do many other statistic measures such as .std(), .count(), .sum() ... etc</span>
</code></pre></div></div>

<h2 id="merge-database">Merge database</h2>

<p>Sometimes we need data from many different tables. 
For example, we have two tables below:<br />
<img src="../pic/vlookup1.png" alt="vlookup1" height="130px" /> <br />
And we want to merge them together: <br />
<img src="../pic/vlookup2.png" alt="vlookup1" height="130px" /> <br />
Many people probablly know how to do this in Excel. You can just use vlookup function. (you will probablly use it a lot in your future jobs)</p>
<pre><code class="language-Excel">=VLOOKUP(A3,$E$3:$F$5,2,FALSE)  
</code></pre>
<p>We can also do this in Pandas with <a href="https://pandas.pydata.org/pandas-docs/stable/generated/pandas.DataFrame.merge.html"><code class="highlighter-rouge">pandas.DataFrame.merge</code></a> (you can click to see documentation).</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># I only listed some frequently used parameters. You can see all parameters in the documentation.  </span>
<span class="n">DataFrame</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">Another_DataFrame</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="s">'inner, outer, left or right'</span><span class="p">,</span> <span class="n">left_on</span><span class="o">=</span><span class="s">"Left_Join_Column_Name"</span><span class="p">,</span> <span class="n">right_on</span><span class="o">=</span><span class="s">"Right_Join_Column_Name"</span><span class="p">)</span>
</code></pre></div></div>
<p>“how” determines the join type. The following chart shows the difference between each kinds of joins, assume column “J” is the join column:<br />
<img src="../pic/join.png" alt="join" height="400px" /> <br /></p>

<p>Let’s have a quick demostration of the merges performed in the charts above.</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># firstly, load in the tables</span>
<span class="n">table1</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s">'J'</span><span class="p">:</span> <span class="p">[</span><span class="s">'A'</span><span class="p">,</span> <span class="s">'B'</span><span class="p">,</span> <span class="s">'D'</span><span class="p">],</span> <span class="s">'X'</span><span class="p">:</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]})</span>
<span class="n">table2</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s">'J'</span><span class="p">:</span> <span class="p">[</span><span class="s">'B'</span><span class="p">,</span> <span class="s">'C'</span><span class="p">,</span> <span class="s">'D'</span><span class="p">],</span> <span class="s">'Y'</span><span class="p">:</span> <span class="p">[</span><span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">]})</span> 
</code></pre></div></div>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># inner join</span>
<span class="n">table1</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">table2</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="s">"inner"</span><span class="p">,</span> <span class="n">right_on</span><span class="o">=</span><span class="s">"J"</span><span class="p">,</span> <span class="n">left_on</span><span class="o">=</span><span class="s">"J"</span><span class="p">)</span>
<span class="c"># outer join</span>
<span class="n">table1</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">table2</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="s">"outer"</span><span class="p">,</span> <span class="n">right_on</span><span class="o">=</span><span class="s">"J"</span><span class="p">,</span> <span class="n">left_on</span><span class="o">=</span><span class="s">"J"</span><span class="p">)</span>
<span class="c"># left join</span>
<span class="n">table1</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">table2</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="s">"left"</span><span class="p">,</span> <span class="n">right_on</span><span class="o">=</span><span class="s">"J"</span><span class="p">,</span> <span class="n">left_on</span><span class="o">=</span><span class="s">"J"</span><span class="p">)</span>
<span class="c"># right join</span>
<span class="n">table1</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">table2</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="s">"right"</span><span class="p">,</span> <span class="n">right_on</span><span class="o">=</span><span class="s">"J"</span><span class="p">,</span> <span class="n">left_on</span><span class="o">=</span><span class="s">"J"</span><span class="p">)</span>
</code></pre></div></div>

<p>Let’s go back to our data. We have two DataFrames, <code class="highlighter-rouge">soda</code> and <code class="highlighter-rouge">invoice</code>. In the <code class="highlighter-rouge">invoice</code> DataFrame, the only information about soda is the “Item_id” column. If we want to see details of the soda associated with each invoice, we need to join the two tables together. Since <code class="highlighter-rouge">soda</code> DataFrame also has “Item_id” column, “Item_id” column can be used as join column.</p>
<blockquote class="challenge">
  <h2 id="challenge-1">Challenge</h2>

  <p>Merge <code class="highlighter-rouge">soda</code> and <code class="highlighter-rouge">inv</code> tables, call it <strong>inv_soda</strong>. 
Not all kinds of soda will appear in the invoice (some were never sold). If we want to keep everything in the <code class="highlighter-rouge">soda</code> dataframe, what kinds of join should we use?</p>

  <blockquote class="solution">
    <h2 id="solution-2">Solution</h2>
    <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>inv_soda = inv.merge(soda, how="left", right_on="Item_id", left_on="Item_id")  
</code></pre></div>    </div>

  </blockquote>
</blockquote>

<blockquote class="challenge">
  <h2 id="challenge-2">Challenge</h2>

  <p>Check how many rows are there in the joined table. Is it the same as the invoice table (930508 rows)?<br />
If they are different, find the exact problem child/children that caused the difference.<br />
Hint: to find which value is empty, you can do <code class="highlighter-rouge">df[df["column_name"].isnull()]</code></p>

  <blockquote class="solution">
    <h2 id="solution-3">Solution</h2>
    <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">len</span><span class="p">(</span><span class="n">inv_soda</span><span class="p">)</span> 
</code></pre></div>    </div>
    <p>The result is 93509 rows. This is because one kind of soda was never sold.<br />
Let’s find out what is it:</p>
    <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>inv_soda[inv_soda["Invoice_id"].isnull()]  
</code></pre></div>    </div>
    <p>Yummy Surstromming Juice. Try it, its good.</p>

  </blockquote>
</blockquote>

<h2 id="aggregate-function">Aggregate Function</h2>

<p>But if we want to summarize by one or more variables, for example, if we want to find out how many bottles has each soda been sold. 
In Excel, we will probablly use pivot table. In Pandas, we can use <strong>Pandas’ <code class="highlighter-rouge">.groupby</code> method</strong>. Once we’ve created a groupby DataFrame, we
can quickly calculate summary statistics by a group of our choice. <br />
Note that Pandas has pivot table too, we will cover later.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># Group data by Item_Description </span>
<span class="c"># The code below counts the number of invoice_id associated with each Item_Description. You can have other </span>
<span class="n">grouped_df</span> <span class="o">=</span> <span class="n">inv_soda</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s">'Item_Description'</span><span class="p">)[</span><span class="s">"Invoice_id"</span><span class="p">]</span><span class="o">.</span><span class="n">agg</span><span class="p">([</span><span class="s">"count"</span><span class="p">])</span>
<span class="n">grouped_df</span>
</code></pre></div></div>
<p>You will get something like this:</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>                      count
Item_Description  
Ace's Energy          262
Ace's Energy Booster  64
Akame's Energy        80
...
</code></pre></div></div>
<p>Note that “Item_Description” and “count” are not at the same level. This is because the groupby function automatically made “Item_Description” the index. If we do <code class="highlighter-rouge">grouped_df.columns</code>, we will only see the <code class="highlighter-rouge">count</code> column. To avoid problems when using the aggregated result, we might want to:</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">grouped_df</span> <span class="o">=</span> <span class="n">inv_soda</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s">'Item_Description'</span><span class="p">)[</span><span class="s">"Invoice_id"</span><span class="p">]</span><span class="o">.</span><span class="n">agg</span><span class="p">([</span><span class="s">"count"</span><span class="p">])</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
<span class="n">grouped_df</span> 
</code></pre></div></div>
<p>The columns are at the same level now.</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  Item_Description        count
0 Ace's Energy            262
1 Ace's Energy Booster    64
2 Akame's Energy          80
...
</code></pre></div></div>
<p>Now if you do <code class="highlighter-rouge">grouped_df.columns</code>, both “Item_Description” and “count” will show up. 
Note that the input in <code class="highlighter-rouge">.agg()</code> is a list. Because we can generate multiple aggregate columns at the same time. For example:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">inv_soda</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s">'Item_Description'</span><span class="p">)[</span><span class="s">"Bottle_Cost"</span><span class="p">]</span><span class="o">.</span><span class="n">agg</span><span class="p">([</span><span class="s">"count"</span><span class="p">,</span> <span class="s">"sum"</span><span class="p">])</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
<span class="c"># think about this, what does it return?   </span>
</code></pre></div></div>

<blockquote class="challenge">
  <h2 id="challenge-3">Challenge</h2>

  <p>Find the average <code class="highlighter-rouge">Bottle_Cost</code> and <code class="highlighter-rouge">Bottle_Retail_Price</code> for each category</p>

  <blockquote class="solution">
    <h2 id="solution-4">Solution</h2>

    <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>inv_soda.groupby('Category')["Bottle_Cost","Bottle_Retail_Price"].agg(["mean"]).reset_index() 

</code></pre></div>    </div>
  </blockquote>
</blockquote>

<h2 id="pivot-table">Pivot Table</h2>
<p>One of the most useful functionalities in Excel is pivot table. You can also create <a href="https://pandas.pydata.org/pandas-docs/stable/generated/pandas.pivot_table.html#pandas-pivot-table">pivot table</a> with Pandas!</p>

<p>A basic pivot table contains the following parameters:</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">pandas</span><span class="o">.</span><span class="n">pivot_table</span><span class="p">(</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">values</span><span class="p">,</span> <span class="n">index</span><span class="p">,</span> <span class="n">columns</span><span class="p">,</span> <span class="n">aggfunc</span><span class="p">)</span>
<span class="c"># values: columns to aggregate (just like choosing the field to report in Excel pivot table)</span>
<span class="c"># index: keys to group by on the pivot table index (just like dragging into the row box in Excel pivot table) </span>
<span class="c"># columns: keys to group by on the pivot table column, (just like dragging into the column box in Excel pivot table) </span>
<span class="c"># aggfunc: aggregate function, for example, mean, sum, min, etc. (just like setting the values box in Excel pivot table)</span>
</code></pre></div></div>
<p>For example you want to see the total bottles sold for each soda in each city, you can:</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>pd.pivot_table(inv_soda, values="Bottles_Sold", index = ["Item_Description"],\
            columns = ["City_Name"], aggfunc="sum")

</code></pre></div></div>
<p>You will get something like this:<br />
<img src="../pic/pivot.png" alt="pt" height="300px" /></p>

<blockquote class="challenge">
  <h2 id="challenge-4">Challenge</h2>

  <p>Create a pivot table that shows the total bottle sold for from each vendor in each category. Set Vendor_Name as index and Category as columns.</p>

  <blockquote class="solution">
    <h2 id="solution-5">Solution</h2>

    <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>pd.pivot_table(inv_soda, values="Bottles_Sold", index = ["Vendor_Name"],\
            columns = ["Category"], aggfunc="sum")

</code></pre></div>    </div>
  </blockquote>
</blockquote>



<blockquote class="keypoints">
  <h2>Key Points</h2>
  <ul>
    
    <li><p>Use <code class="highlighter-rouge">read_csv</code> to read tabular data into Python.</p>
</li>
    
    <li><p>use sort_values([columns]) to sort the dataframe.</p>
</li>
    
    <li><p>use df_object.column_name or df_object[column_name] to select one column.</p>
</li>
    
    <li><p>use df_object[list_of_column_names] to select multiple columns.</p>
</li>
    
    <li><p>use df_object[condition] to filter data. For example, df_object[df_object[column_name] == value].</p>
</li>
    
    <li><p>use .describe() to get descriptive statistics of one column.</p>
</li>
    
    <li><p>use df1.merge(df2) to merge two DataFrames.</p>
</li>
    
    <li><p>use df_object.groupby(column_list1)[column_list2].agg(list_of_aggregate_function) to apply aggregation on data group by column_list1.</p>
</li>
    
    <li><p>Create pivot table with pandas.pivot_table</p>
</li>
    
  </ul>
</blockquote>

</article>

<div class="row">
  <div class="col-xs-1">
    <h3 class="text-left">
      
      <a href="../02-func/"><span class="glyphicon glyphicon-menu-left" aria-hidden="true"></span><span class="sr-only">previous episode</span></a>
      
    </h3>
  </div>
  <div class="col-xs-10">
    
  </div>
  <div class="col-xs-1">
    <h3 class="text-right">
      
      <a href="../04-stat_vis/"><span class="glyphicon glyphicon-menu-right" aria-hidden="true"></span><span class="sr-only">next episode</span></a>
      
    </h3>
  </div>
</div>


      
      
<footer>
  <div class="row">
    <div class="col-md-6" align="left">
      <h4>
	Copyright &copy; 2016–2018
	
	<a href="https://software-carpentry.org">Software Carpentry Foundation</a>
	
      </h4>
    </div>
    <div class="col-md-6" align="right">
      <h4>
	
	<a href="/edit/gh-pages/_episodes/03-pandas.md">Edit on GitHub</a>
	
	/
	<a href="/blob/gh-pages/CONTRIBUTING.md">Contributing</a>
	/
	<a href="/">Source</a>
	/
	<a href="/blob/gh-pages/CITATION">Cite</a>
	/
	<a href="lessons@software-carpentry.org">Contact</a>
      </h4>
    </div>
  </div>
</footer>

      
    </div>
    
<script src="../assets/js/jquery.min.js"></script>
<script src="../assets/js/bootstrap.min.js"></script>
<script src="../assets/js/lesson.js"></script>
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-37305346-2', 'auto');
  ga('send', 'pageview');
</script>

  </body>
</html>
